#!/usr/bin/env node

'use strict';

/**
 * Module dependencies.
 */
var vault = require('./models/vault');
var mongoose = require('mongoose');
var holvit = mongoose.model('Vault', vault.vaultSchema);
var config = require('./config/config');

var db = mongoose.connect(config.db);

holvit.find({}, function (err, vaults) {
    vaults.forEach(function(vault) {

    	var oneDay = 24*60*60*1000;
		var today = new Date();

		var diffDays = Math.round(Math.abs((today.getTime() - vault.end_date.getTime())/oneDay));
		diffDays++;

		// jos ei ryöstetty ja rahaa holvissa ja aika umpeutunut
		// siirrä rahat omistajalle ja poista holvi

		if(diffDays < 0){
			console.log('holvi: ' + vault.title + ' poistetaan ja rahat palautetaan korkoineen');
		}

    });

});